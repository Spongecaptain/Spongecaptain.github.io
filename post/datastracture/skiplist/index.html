<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>SkipList - Spongecaptain 的个人技术博客</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Spongecaptain" /><meta name="description" content="跳表作为一种数据结构，由 William Pugh 在其在 1990 年发表的论文 Skip Lists: A Probabilistic Alternative to Balanced Trees 中提出。 1. 逻辑上的跳表 将跳表称为跳跃查询的链表更合适。 无论采用哪一种数据结构" /><meta name="keywords" content="skip list, 跳表" />






<meta name="generator" content="Hugo 0.67.0 with theme even" />


<link rel="canonical" href="https://spongecaptain.cool/post/datastracture/skiplist/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.e6549b501dbc4389b872bd7b2f32a09625027aa099dcfd924adda23a8e9b81bf.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="SkipList" />
<meta property="og:description" content="跳表作为一种数据结构，由 William Pugh 在其在 1990 年发表的论文 Skip Lists: A Probabilistic Alternative to Balanced Trees 中提出。 1. 逻辑上的跳表 将跳表称为跳跃查询的链表更合适。 无论采用哪一种数据结构" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://spongecaptain.cool/post/datastracture/skiplist/" />
<meta property="article:published_time" content="2020-08-04T16:11:01+08:00" />
<meta property="article:modified_time" content="2020-08-04T16:11:01+08:00" />
<meta itemprop="name" content="SkipList">
<meta itemprop="description" content="跳表作为一种数据结构，由 William Pugh 在其在 1990 年发表的论文 Skip Lists: A Probabilistic Alternative to Balanced Trees 中提出。 1. 逻辑上的跳表 将跳表称为跳跃查询的链表更合适。 无论采用哪一种数据结构">
<meta itemprop="datePublished" content="2020-08-04T16:11:01&#43;08:00" />
<meta itemprop="dateModified" content="2020-08-04T16:11:01&#43;08:00" />
<meta itemprop="wordCount" content="3055">



<meta itemprop="keywords" content="skip list,跳表," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SkipList"/>
<meta name="twitter:description" content="跳表作为一种数据结构，由 William Pugh 在其在 1990 年发表的论文 Skip Lists: A Probabilistic Alternative to Balanced Trees 中提出。 1. 逻辑上的跳表 将跳表称为跳跃查询的链表更合适。 无论采用哪一种数据结构"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body class = body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Spongecaptain&#39;s Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/about/index.html">
        <li class="mobile-menu-item">About</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Spongecaptain&#39;s Blog</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/index.html">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">SkipList</h1>

      <div class="post-meta">
        <span class="post-time"> 2020-08-04 </span>
        <div class="post-category">
            <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"> 数据结构 </a>
            </div>
          <span class="more-meta"> 约 3055 字 </span>
          <span class="more-meta"> 预计阅读 7 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#1-逻辑上的跳表">1. 逻辑上的跳表</a></li>
    <li><a href="#2-实际的跳表">2. 实际的跳表</a></li>
    <li><a href="#3-跳表与其他数据结构">3. 跳表与其他数据结构</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <blockquote>
<p>跳表作为一种数据结构，由 William Pugh 在其在 1990 年发表的论文 <a href="ftp://ftp.cs.umd.edu/pub/skipLists/skiplists.pdf">Skip Lists: A Probabilistic Alternative to Balanced Trees</a> 中提出。</p>
</blockquote>
<h2 id="1-逻辑上的跳表">1. 逻辑上的跳表</h2>
<blockquote>
<p>将跳表称为跳跃查询的链表更合适。</p>
</blockquote>
<p>无论采用哪一种数据结构，如果想要提高查询的效率，势必需要引入顺序性，例如：</p>
<ul>
<li>
<p>有序数组：采用二分法来加快查询速度；</p>
<p><img src="../../../images/img_dataStracture/image-20200804111047980.png" alt="image-20200804111047980" style="zoom:25%;" /></p>
</li>
<li>
<p>B+ 树：采用 B+ 树作为数据结构的索引可以可以依赖于有序快速进行查找；</p>
</li>
</ul>
<p>上述两种方式的查询时间复杂度都是 <code>O(logN)</code> ，但是有着各自的缺点：</p>
<ul>
<li>有序数组的缺点：插入新元素时需要以二分法进行比较，时间复杂度 <code>O(logN)</code>，然后插入时需要将待插入位置以及后续元素整体向后搬移，时间复杂度 <code>O(N)</code>。可见有序数组在插入元素时开销非常大；</li>
<li>B+ 树：B + 树可以说是对红黑树的改进版本，主要缺点在于具体实现比较复杂；</li>
</ul>
<p>跳跃表基于有序链表实现，链表的插入元素和查询的效率如下：</p>
<ul>
<li>
<p>插入时无法使用二分法，因而需要从前向后遍历比较，直到找到应当插入的位置。比较的效率为  <code>O(N)</code>，插入的效率为 <code>O(N)</code>；</p>
<blockquote>
<p>链表解决了数组的单纯插入操作效率较低问题，但是却额外引入了比较无法使用二分法效率低下的问题，其和数组相比效率甚至更差一些。</p>
<p>本质原因：仅仅为了有序性在付出额外性能开销，但是没有从有序性得到任何性能上的好处。</p>
</blockquote>
</li>
<li>
<p>查询时也无法使用二分法，因而需要从前向后遍历比较查询，比较的效率为  <code>O(N)</code>；</p>
</li>
</ul>
<p><img src="../../../images/img_dataStracture/image-20200804111819658.png" alt="image-20200804111819658" style="zoom:25%;" /></p>
<p>可见链表的最大的问题就是不能使用二分法进行查询，无论是查询还是插入元素都需要依次遍历，节点元素之间的有序性根本就没用到。</p>
<p>为此，跳跃表吸收了 B+ 树的思想，也使用索引，只不过跳跃表的索引基于链表实现而非树实现，其实现如下图所示：</p>
<p><img src="../../../images/img_dataStracture/image-20200804112816024.png" alt="image-20200804112816024"></p>
<p>在这里，我们从原有序链表中取出奇数位置的节点作为关键节点链表，在查询或者插入比较时，先通过关键节点链表的比较再去原有序链表中进行比较。例如，如果要插入值为 13 的节点，那么原本需要比较：1、4、9、14 节点，现在只需比较 1、9、14 节点，平均可以节约 1/2 的查询时间。</p>
<p>不过，这里由于节点较少，查询效率的提高并不明显，另一方面，仅仅只有一层关键节点链表仅仅能提高一倍的查询效率，为了解决这个问题，我们可以建立多层关键链表节点，每一层都选取下一层的部分节点作为元素，比如我们建立两层索引的跳表的数据结构如下：</p>
<p><img src="../../../images/img_dataStracture/image-20200804113631837-6528751.png" alt="image-20200804113631837" style="zoom:25%;" /></p>
<p>可见，最终的查询效率为原本的 2^n^ 倍，其中 n 为索引的层数，不过效率的提高有一个极限，意味当最高层索引元素只有 2 个时，已经不够再向上叠加新的索引层了，换言之，最终的查询效率至多可以到 <code>O(logN)</code>。</p>
<p>跳跃表的 skip 含义就是为了强调虽然其基于链表，但是不同于链表单向的<strong>逐个</strong>节点比较，而是可以跳跃若干个节点后进行比较（跳跃即逐个的反义词）。</p>
<hr>
<p>不过，跳跃表和大多数索引数据结构有着一样的问题，在元素删减的时候需要维护索引数据结构，具体来说便是：</p>
<ul>
<li>添加新元素节点时，如果索引不同时进行更新，那么索引就会因为没有覆盖大部分元素而降低查找效率；</li>
<li>删除新元素节点时，如果索引中有对应的节点，如果此时不删除，那么就会引发空指针异常；</li>
</ul>
<p>删除节点时通过高层索引向低层索引层层递进，进行查找，因此时间复杂度在层数最高时为  <code>O(logN)</code>，逻辑也比较简单，相当于查询的过程中顺便将节点元素删除了。</p>
<p>添加节点时逻辑要更复杂一些，因为涉及将哪一个节点选举为高层索引的问题。每一层对于新添加节点的选举逻辑是抛硬币，也就是有 50% 的概率选举为上层链表的节点，被选举的节点需要插入到上层链表的相应位置中。然后，又进行抛硬币，判断是否要选举到上上层链表。因此一个新接入的节点即可能没有加入任何索引中，也有可能加入到所有索引中。这是一个递归的过程，直到某一次选举失败。</p>
<blockquote>
<p>之前的奇偶法选举很难实现，一方面增删元素时会导致元素的奇偶性改变，另一方面，节点没有下标索引，因此很难表示某一个节点奇偶性。</p>
</blockquote>
<p><strong>为什么采用抛硬币的方式？</strong></p>
<ul>
<li>节点选举是比较困难的，因为跳跃表的节点增删操作不可预测，很难用一种有效的算法确保跳表的索引对于最底层的链表来说是均匀的；</li>
<li>如果强行追求上层节点个数恰好为下层节点个数的 2 倍，那么</li>
<li>大数据理论告诉我们，当节点元素足够多时，这种选举策略是趋近于均匀分布的；</li>
</ul>
<p>总结一下跳表的增删元素的操作：</p>
<ul>
<li>增加元素
<ul>
<li>新节点和各层索引节点逐一比较，确定原链表的插入位置。O(logN)</li>
<li>把索引插入到原链表。O(1)</li>
<li>利用抛硬币的随机方式，决定新节点是否提升为上一级索引。结果为 “正” 则提升并继续抛硬币，结果为 “负” 则停止。O(logN)</li>
</ul>
</li>
<li>删除元素
<ul>
<li>自上而下，查找第一次出现节点的索引，并逐层找到每一层对应的节点。O(logN)</li>
<li>删除每一层查找到的节点，如果该层只剩下 1 个节点，删除整个一层（原链表除外）。O(logN)</li>
</ul>
</li>
</ul>
<p>总体上，跳跃表删除操作的时间复杂度是 O(logN)。</p>
<h2 id="2-实际的跳表">2. 实际的跳表</h2>
<p>逻辑上的跳表有一个问题，节点信息存在冗余存储。拿下图为例：</p>
<p><img src="../../../images/img_dataStracture/image-20200804113631837.png" alt="image-20200804113631837" style="zoom:25%;" /></p>
<p>存在冗余的节点有：</p>
<ul>
<li>节点 1、节点 15 一共出现了 3 次；</li>
<li>节点 9 出现了 2 次。</li>
</ul>
<p>为了避免存储信息的冗余，我们对于原有序链表的每一个节点不再要求其仅仅能使用一个向后的指针，而是多个。</p>
<blockquote>
<p>这点类似于从二叉树转变为多路二叉树时节点可以拥有不止 2 个向后的节点引用指针。</p>
</blockquote>
<p>我们先来看一个有序链表，如下图（最左侧的灰色节点表示一个空的头结点）：</p>
<blockquote>
<p>下面的若干张图引来自<a href="https://www.zhihu.com/people/zhtielei">张铁蕾</a>。</p>
</blockquote>
<p><img src="../../../images/img_dataStracture/image-20200804150110591.png" alt="image-20200804150110591"></p>
<p>假如我们每相邻两个节点增加一个指针，让指针指向下下个节点，如下图：</p>
<p><img src="../../../images/img_dataStracture/image-20200804150131812.png" alt="image-20200804150131812"></p>
<blockquote>
<p>这样一来在逻辑上相当于构造了两个单向链表，通过在每一个节点中使用额外的指针避免重复使用节点。</p>
</blockquote>
<p>利用同样的方式，我们可以在上层新产生的链表上，继续为每相邻的两个节点增加一个指针，从而产生第三层链表。如下图：</p>
<p><img src="../../../images/img_dataStracture/image-20200804150153773.png" alt="image-20200804150153773"></p>
<p>不过需要注意的是，每增加一层还是要为每一层单独增加该层的头节点，头节点是跳表每一层的起始节点。</p>
<blockquote>
<p>你可以观察到第一个灰色块从一开始的单个节点元素逐渐增加到 3 个节点元素。</p>
</blockquote>
<hr>
<h2 id="3-跳表与其他数据结构">3. 跳表与其他数据结构</h2>
<p><strong>跳跃表和平衡二叉搜索树的区别</strong>：</p>
<ul>
<li>数据结构不同：跳跃表基于链表，平衡二叉搜索树基于树；</li>
<li>索引的维护效率：跳跃表依靠抛硬币的随机方式维护索引（要求尽量平衡或平均），成本比较低，而平衡二叉搜索树需要基于特定的 reblance 算法重新调整树状结构。</li>
<li>平衡性：跳跃表的平衡性依据随机性来包装，因此最终的查找效率至多趋近于 <code>O(logN)</code>，但是平衡二叉树通过 rebalance 算法，能够达到 <code>O(logN)</code> 的查找效率；</li>
<li>范围查找的复杂性：在做范围查找的时候，平衡树比 skiplist 操作要复杂。在平衡树上，我们找到指定范围的小值之后，还需要以中序遍历的顺序继续寻找其它不超过大值的节点。如果不对平衡树进行一定的改造，这里的中序遍历并不容易实现。而在 skiplist 上进行范围查找就非常简单，只需要在找到小值之后，对第 1 层链表进行若干步的遍历就可以实现。</li>
<li>内存占用角度：从内存占用上来说，skiplist 比平衡树更灵活一些。一般来说，平衡树每个节点包含 2 个指针（分别指向左右子树），而 skiplist 每个节点包含的指针数目平均为 1/(1-p)，具体取决于参数 p 的大小。如果像 Redis 里的实现一样，取 p=1/4，那么平均每个节点包含 1.33 个指针，比平衡树更有优势。</li>
<li>算法难度：从算法实现难度上来比较，skiplist 比平衡树要简单得多了；</li>
</ul>
<p><strong>Hash 表的独有特点</strong>：skiplist 和各种平衡树（如 AVL、红黑树等）的元素是有序排列的，而哈希表不是有序的。因此，在哈希表上只能做单个 key 的查找，不适宜做范围查找。所谓范围查找，指的是查找那些大小在指定的两个值之间的所有节点。</p>
<p><strong>查询效率的比较</strong>：查找单个 key，skiplist 和平衡树的时间复杂度都为 <code>O(logN)</code>，大体相当；而哈希表在保持较低的哈希值冲突概率的前提下，查找时间复杂度接近 O (1)，性能更高一些。所以我们平常使用的各种 Map 或 dictionary 结构，大都是基于哈希表实现的。</p>
<p>##4. 引用说明</p>
<p>部分引用：</p>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/23370124">https://zhuanlan.zhihu.com/p/23370124</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/53975333">https://zhuanlan.zhihu.com/p/53975333</a></li>
</ul>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/skip-list/">skip list</a>
          <a href="/tags/%E8%B7%B3%E8%A1%A8/">跳表</a>
          </div>
      <nav class="post-nav">
        
        <a class="next" href="/post/paper/mapreduce_paper_read_summary/">
            <span class="next-text nav-default">MapReduce 论文学习</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>


      <h3>转载申请</h3>
      <a rel=license href=http://creativecommons.org/licenses/by/4.0/>
        <img alt=知识共享许可协议 style=border-width:0 src=https://img.draveness.me/creative-commons.png>
      </a>
      <br>本作品采用
      <a rel=license href=http://creativecommons.org/licenses/by/4.0/ target="_blank" style="text-decoration:underline;" >
      知识共享署名 4.0 国际许可协议</a>
      进行许可，转载时请注明作者姓名以及原文链接，图片在使用时请保留全部内容，可适当缩放并在引用处附上图片所在的文章链接。

      
    </footer>
  </article>
        </div>
        <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js" crossorigin="anonymous"></script>
    <script type="text/javascript">
      var gitalk = new Gitalk({
        id: '2020-08-04 16:11:01 \x2b0800 CST',
        title: 'SkipList',
        clientID: 'b8e9909664fb69930809',
        clientSecret: '847d9069c9532ab260721afb9f036cdb8f52aec4',
        repo: 'Spongecaptain.github.io',
        owner: 'Spongecaptain',
        admin: ['Spongecaptain'],
        body: decodeURI(location.href)
      });
      gitalk.render('gitalk-container');
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/gitalk/gitalk">comments powered by gitalk.</a></noscript>

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:wjjiang19@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/spongecaptain" class="iconfont icon-github" title="github"></a>
  <a href="https://spongecaptain.cool/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2019 - 
    2020
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Spongecaptain</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.d7b7ada643c9c1a983026e177f141f7363b4640d619caf01d8831a6718cd44ea.js"></script>








</body>
</html>
